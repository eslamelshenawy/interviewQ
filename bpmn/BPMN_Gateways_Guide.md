# BPMN Gateways - الدليل الشامل

## جدول المحتويات
1. [مقدمة عن البوابات](#مقدمة-عن-البوابات)
2. [Exclusive Gateway (XOR)](#exclusive-gateway-xor)
3. [Parallel Gateway (AND)](#parallel-gateway-and)
4. [Inclusive Gateway (OR)](#inclusive-gateway-or)
5. [Event-Based Gateway](#event-based-gateway)
6. [Complex Gateway](#complex-gateway)
7. [Exclusive Event-Based Gateway](#exclusive-event-based-gateway)
8. [Parallel Event-Based Gateway](#parallel-event-based-gateway)
9. [المقارنة بين البوابات](#المقارنة-بين-البوابات)
10. [أمثلة عملية متقدمة](#أمثلة-عملية-متقدمة)
11. [الأخطاء الشائعة](#الأخطاء-الشائعة)
12. [أفضل الممارسات](#أفضل-الممارسات)

---

## مقدمة عن البوابات

**Gateway** هي نقطة تحكم في تدفق العملية. تُستخدم لـ:
- **التفرّع (Diverging)**: تقسيم التدفق إلى مسارات متعددة
- **الدمج (Converging)**: دمج مسارات متعددة في مسار واحد

### الشكل العام:
- **معين (ماسة) ◇**
- يحتوي على رمز يدل على نوع البوابة
- يمكن أن يكون Diverging أو Converging أو Both

### أنواع البوابات الرئيسية:
```
Gateways
├── Exclusive (XOR) - اختيار واحد فقط
├── Parallel (AND) - جميع المسارات
├── Inclusive (OR) - واحد أو أكثر
├── Event-Based - بناءً على الأحداث
└── Complex - قواعد معقدة
```

---

## Exclusive Gateway (XOR)

### الوصف
**بوابة الاختيار الحصري** - يتم اختيار مسار واحد فقط من بين المسارات المتاحة.

### الرموز
- **X** داخل المعين
- أو معين فارغ (الافتراضي في BPMN 2.0)

### الشكل
```
        ↓
      ⬦ X ⬦
    ↙   ↓   ↘
  نعم  لا   ربما
```

### الخصائص الأساسية
- ✅ مسار واحد فقط يُفعّل
- ✅ يُقيّم الشروط بالترتيب
- ✅ يجب أن يكون هناك مسار افتراضي (Default Flow)
- ✅ الشروط يجب أن تكون متنافية (Mutually Exclusive)

---

### 1. Diverging Exclusive Gateway (التفرّع)

**الوظيفة**: تقييم الشروط واختيار مسار واحد فقط

**مثال بسيط: موافقة على طلب**
```
[تقديم طلب]
      ↓
    ⬦ X ⬦  الطلب مُوافق عليه؟
    ↙     ↘
  نعم      لا
   ↓        ↓
[موافقة] [رفض]
```

**مثال متوسط: تصنيف العملاء**
```
[حساب قيمة الطلب]
      ↓
    ⬦ X ⬦
    ↙ ↓ ↘
   ↙  ↓  ↘
  ↙   ↓   ↘
[VIP] [عادي] [جديد]
أكثر  100-  أقل
من    1000  من
1000       100

الشروط:
- orderValue > 1000 → VIP
- orderValue >= 100 AND orderValue <= 1000 → عادي
- orderValue < 100 → جديد
```

**مثال معقد: معالجة المخالفات المرورية**
```
[استلام مخالفة]
      ↓
    ⬦ X ⬦  نوع المخالفة؟
    ↙ ↓ ↓ ↘
   /  | |  \
  /   | |   \
[تحذير] [غرامة] [حجز رخصة] [حجز مركبة]
سرعة   سرعة    قيادة      قيادة
طفيفة  زائدة   متهورة    تحت تأثير

الشروط:
- speedOver <= 20 km/h → تحذير
- speedOver > 20 AND speedOver <= 40 → غرامة
- recklessDriving = true → حجز رخصة
- underInfluence = true → حجز مركبة
```

**مثال تقني مع الأكواد**:
```
[حساب الأهلية للقرض]
      ↓
    ⬦ X ⬦
    ↙ ↓ ↘
   /  |  \
[موافق] [موافق مشروط] [مرفوض]

الشروط البرمجية:
Path 1: creditScore >= 700 && income >= 5000
        → موافق

Path 2: creditScore >= 600 && income >= 3000
        → موافق مشروط

Path 3: [Default Flow]
        → مرفوض
```

---

### 2. Converging Exclusive Gateway (الدمج)

**الوظيفة**: انتظار وصول أي مسار من المسارات السابقة ثم المتابعة

**خصائص**:
- لا يُقيّم شروطاً
- ينتظر أول مسار يصل
- يُستخدم لدمج مسارات Diverging Exclusive Gateway

**مثال بسيط**:
```
    ⬦ X ⬦
    ↙     ↘
  نعم      لا
   ↓        ↓
[موافقة] [رفض]
   ↓        ↓
    ↘     ↙
      ⬦ X ⬦  ← Converging
         ↓
    [المتابعة]
```

**مثال: نظام موافقة متدرج**
```
[طلب شراء]
      ↓
    ⬦ X ⬦  المبلغ؟
    ↙ ↓ ↘
   /  |  \
[موظف] [مدير] [مدير عام]
<1K   1K-10K  >10K
  |     |       |
  ↓     ↓       ↓
[موافقة] [موافقة] [موافقة]
  موظف    مدير    م.عام
   ↓      ↓       ↓
    ↘     |      ↙
      ⬦ X ⬦  ← Converging
         ↓
    [تنفيذ الطلب]
```

---

### 3. أمثلة واقعية متقدمة

**مثال A: نظام تسعير ديناميكي**
```
[حساب السعر الأساسي]
      ↓
    ⬦ X ⬦  نوع العميل؟
    ↙ ↓ ↓ ↘
   /  | |  \
[VIP][شركات][عادي][جديد]
20%   15%    5%     0%
خصم   خصم   خصم    خصم
  |    |     |      |
  ↓    ↓     ↓      ↓
  [تطبيق الخصم]
  [تطبيق الخصم]
  [تطبيق الخصم]
  [بدون خصم]
   ↓    ↓     ↓      ↓
    ↘   |     |     ↙
      ⬦ X ⬦  ← Converging
         ↓
    ⬦ X ⬦  الكمية؟
    ↙ ↓ ↘
   /  |  \
[خصم][خصم][لا شيء]
كبير وسط
>100  >50  <=50
10%   5%
  |    |    |
  ↓    ↓    ↓
   ↘   |   ↙
     ⬦ X ⬦
        ↓
   [السعر النهائي]
```

**مثال B: معالجة استثناءات الشحن**
```
[جاهز للشحن]
      ↓
    ⬦ X ⬦  الوجهة؟
    ↙ ↓ ↓ ↘
   /  | |  \
[محلي][إقليمي][دولي][نائي]
1-2  3-5   7-14  حسب
يوم  أيام  يوم  الطلب
  |    |     |     |
  ↓    ↓     ↓     ↓
  |    |     |   [اتصال بالعميل]
  |    |     |        ↓
  |    |     |   ⬦ X ⬦ موافق؟
  |    |     |    ↙    ↘
  |    |     |  نعم    لا
  |    |     |   |      ↓
  |    |     |   |   [إلغاء]
  |    |     |   |      ↓
  |    |     |   |   [End]
  ↓    ↓     ↓   ↓
   ↘   |     |  ↙
      ⬦ X ⬦
         ↓
    [شحن المنتج]
```

---

### متى تستخدم Exclusive Gateway؟

✅ **استخدم عندما**:
- اتخاذ قرار بناءً على شرط واحد
- اختيار مسار من عدة مسارات متاحة
- القرار ثنائي (نعم/لا)
- التفرع بناءً على قيمة متغير

❌ **لا تستخدم عندما**:
- تريد تنفيذ عدة مسارات بالتوازي → استخدم Parallel Gateway
- الشروط غير متنافية → استخدم Inclusive Gateway
- القرار يعتمد على حدث خارجي → استخدم Event-Based Gateway

---

## Parallel Gateway (AND)

### الوصف
**بوابة التوازي** - تفعيل جميع المسارات معاً في نفس الوقت.

### الرمز
- **+** داخل المعين

### الشكل
```
        ↓
      ⬦ + ⬦
    ↙   ↓   ↘
 مسار1 مسار2 مسار3
(جميعها تُفعّل معاً)
```

### الخصائص الأساسية
- ✅ جميع المسارات تُفعّل في نفس الوقت
- ✅ لا توجد شروط على المسارات
- ✅ عند الدمج، ينتظر وصول جميع المسارات
- ✅ مثالية للمهام المستقلة

---

### 1. Diverging Parallel Gateway (التفرّع)

**الوظيفة**: تفعيل جميع المسارات الخارجة بدون شروط

**مثال بسيط: معالجة طلب**
```
[استلام الطلب]
      ↓
    ⬦ + ⬦
    ↙ ↓ ↘
   /  |  \
[تحقق  [حساب [إشعار
 من     السعر] العميل]
 المخزون]
  |      |      |
```
**جميع المهام الثلاث تحدث في نفس الوقت!**

**مثال متوسط: إعداد موظف جديد**
```
[قبول عرض العمل]
      ↓
    ⬦ + ⬦
    ↙ ↓ ↓ ↘
   /  | |  \
[إنشاء] [طلب] [حجز] [إعداد]
حساب  معدات مكتب   تدريب
IT
  |     |     |      |
```
**الأقسام المختلفة تعمل بالتوازي**

**مثال معقد: معالجة طلب قرض**
```
[تقديم طلب القرض]
      ↓
    ⬦ + ⬦  ← افتح 4 مسارات متوازية
    ↙ ↓ ↓ ↘
   /  | |  \
  /   | |   \
[التحقق] [فحص] [تقييم] [فحص]
من      السجل العقار  الدخل
الهوية  الائتماني

عبر     عبر     عبر    عبر
API     API     خبير   API
خارجي   خارجي           البنك

30 ثانية 2 دقيقة 1 يوم  1 دقيقة
```

---

### 2. Converging Parallel Gateway (الدمج)

**الوظيفة**: انتظار وصول جميع المسارات ثم المتابعة

**خصائص**:
- ينتظر جميع المسارات (Synchronization Point)
- لا يتابع حتى تصل جميع المسارات
- يُشكّل نقطة تزامن

**مثال كامل: فحص شامل لسيارة**
```
[استلام السيارة]
      ↓
    ⬦ + ⬦  ← Diverging (افتح 3 مسارات)
    ↙ ↓ ↘
   /  |  \
[فحص] [فحص] [فحص]
المحرك الهيكل الكهرباء
  |     |      |
  ↓     ↓      ↓
[تقرير] [تقرير] [تقرير]
المحرك الهيكل الكهرباء
  |     |      |
   ↘    ↓     ↙
      ⬦ + ⬦  ← Converging (انتظر الجميع)
         ↓
   [دمج التقارير]
         ↓
   [التقرير النهائي]
```

**سيناريو التنفيذ**:
```
الوقت 0:00 → بدء الفحوص الثلاثة معاً
الوقت 0:15 → فحص الكهرباء انتهى ✓
الوقت 0:25 → فحص الهيكل انتهى ✓
الوقت 0:30 → فحص المحرك انتهى ✓
الوقت 0:30 → الآن فقط ينتقل للخطوة التالية
```

**مثال: موافقات متوازية**
```
[طلب مشروع كبير]
      ↓
    ⬦ + ⬦  يجب موافقة الجميع
    ↙ ↓ ↓ ↘
   /  | |  \
[موافقة] [موافقة] [موافقة] [موافقة]
المالية التقنية  القانون  الإدارة
   |       |        |        |
   ↓       ↓        ↓        ↓
  ✅      ✅       ✅       ✅
   |       |        |        |
    ↘      |        |       ↙
       ↘   |        |     ↙
          ⬦ + ⬦  ← يجب أن يوافق الجميع
             ↓
      [بدء المشروع]
```

---

### 3. أمثلة واقعية متقدمة

**مثال A: إطلاق منتج جديد**
```
[الموافقة على إطلاق المنتج]
      ↓
    ⬦ + ⬦
    ↙ ↓ ↓ ↓ ↘
   /  | | |  \
  /   | | |   \
[إنتاج] [تسويق] [مبيعات] [دعم] [توزيع]

  |       |        |       |       |
  ↓       ↓        ↓       ↓       ↓

[تصنيع] [حملة] [تدريب] [إعداد] [شحن]
10000   إعلانية الفريق  قاعدة  للفروع
وحدة             معرفة

  |       |        |       |       |
  ↓       ↓        ↓       ↓       ↓

[مراقبة] [نشر] [إعداد] [تجهيز] [توزيع]
الجودة  المواد عروض  الدعم   جغرافي
               الأسعار الفني

  |       |        |       |       |
   ↘      |        |       |      ↙
      ↘   |        |       |    ↙
         ⬦ + ⬦  كل شيء جاهز
            ↓
      [🎉 إطلاق المنتج]
            ↓
      [المتابعة والتقييم]
```

**مثال B: فحص أمني شامل**
```
[طلب الوصول لنظام حساس]
      ↓
    ⬦ + ⬦  فحوصات متوازية
    ↙ ↓ ↓ ↓ ↘
   /  | | |  \
  /   | | |   \
[فحص] [فحص] [فحص] [فحص] [فحص]
الهوية الصلاحيات السجل IP المصادقة
              الأمني  Address الثنائية
  |     |       |      |       |
  ↓     ↓       ↓      ↓       ↓

API   قاعدة   قاعدة  GeoIP  OTP/SMS
      بيانات  بيانات Service

  |     |       |      |       |
  ↓     ↓       ↓      ↓       ↓

[✓/✗] [✓/✗]  [✓/✗]  [✓/✗]   [✓/✗]

  |     |       |      |       |
   ↘    |       |      |      ↙
      ↘ |       |      |    ↙
         ⬦ + ⬦  جميع الفحوصات
            ↓
         ⬦ X ⬦  كلها نجحت؟
         ↙     ↘
       نعم      لا
        ↓        ↓
    [منح    [رفض الوصول]
     الوصول]    ↓
        ↓     [تسجيل المحاولة]
    [تسجيل       ↓
     الدخول]  [إشعار الأمن]
```

**مثال C: نشر تطبيق (CI/CD)**
```
[اكتمال التطوير]
      ↓
[دمج الكود (Merge)]
      ↓
    ⬦ + ⬦  مراحل متوازية
    ↙ ↓ ↓ ↘
   /  | |  \
[اختبار] [فحص] [تدقيق] [بناء]
الوحدة  الأمان الكود   الحاوية
Unit    Security Code   Docker
Tests   Scan    Review  Build
  |       |      |       |
  ↓       ↓      ↓       ↓
Jest    Snyk   SonarQube Docker
  |       |      |       |
  ↓       ↓      ↓       ↓
200     تقرير  تقرير    صورة
اختبار  الثغرات الجودة  جاهزة
  |       |      |       |
   ↘      |      |      ↙
       ⬦ + ⬦  كل شيء نجح؟
          ↓
       ⬦ X ⬦
       ↙     ↘
     نعم      لا
      ↓        ↓
    ⬦ + ⬦    [فشل النشر]
    ↙ ↓ ↘       ↓
   /  |  \   [إشعار الفريق]
[نشر] [نشر] [نشر]     ↓
Dev   Staging Prod    [End]

  |     |      |
   ↘    |     ↙
       ⬦ + ⬦
          ↓
     [النشر مكتمل]
          ↓
     [مراقبة الأداء]
```

---

### متى تستخدم Parallel Gateway؟

✅ **استخدم عندما**:
- المهام مستقلة عن بعضها
- يمكن تنفيذها في نفس الوقت
- جميع المهام مطلوبة
- تريد تقليل الوقت الإجمالي

❌ **لا تستخدم عندما**:
- المهام تعتمد على بعضها البعض
- لا حاجة لتنفيذ جميع المسارات
- ترتيب التنفيذ مهم

**ملاحظة مهمة**:
```
⚠️ خطأ شائع:

    ⬦ + ⬦  فتح
    ↙     ↘
  مسار1   مسار2
    ↓       ↓
    |       |    ← ✗ لم يتم إغلاق Parallel Gateway
    ↓       ↓
  [End]   [End]

✅ الصحيح:

    ⬦ + ⬦  فتح
    ↙     ↘
  مسار1   مسار2
    ↓       ↓
     ↘     ↙
       ⬦ + ⬦  إغلاق
          ↓
       [End]
```

---

## Inclusive Gateway (OR)

### الوصف
**بوابة الشمول** - تفعيل واحد أو أكثر من المسارات بناءً على الشروط.

### الرمز
- **○** (دائرة) داخل المعين

### الشكل
```
        ↓
      ⬦ ○ ⬦
    ↙   ↓   ↘
 شرط1  شرط2  شرط3
(يمكن تفعيل أكثر من واحد)
```

### الخصائص الأساسية
- ✅ تفعيل مسار واحد أو أكثر
- ✅ يقيّم جميع الشروط
- ✅ الشروط يمكن أن تتحقق معاً
- ✅ عند الدمج، ينتظر المسارات المُفعّلة فقط

### الفرق عن Exclusive و Parallel

| الميزة | Exclusive (XOR) | Parallel (AND) | Inclusive (OR) |
|--------|----------------|----------------|----------------|
| عدد المسارات المُفعّلة | واحد فقط | الجميع | واحد أو أكثر |
| الشروط | متنافية | لا شروط | يمكن أن تتحقق معاً |
| الدمج | ينتظر أي مسار | ينتظر الجميع | ينتظر المُفعّلة فقط |

---

### 1. Diverging Inclusive Gateway (التفرّع)

**الوظيفة**: تقييم جميع الشروط وتفعيل المسارات التي تتحقق شروطها

**مثال بسيط: إشعارات متعددة**
```
[تأكيد الطلب]
      ↓
    ⬦ ○ ⬦  كيف تريد الإشعار؟
    ↙ ↓ ↘
   /  |  \
[بريد] [SMS] [تطبيق]
إلكتروني

الشروط:
- emailEnabled = true → بريد
- smsEnabled = true → SMS
- appEnabled = true → تطبيق

يمكن تفعيل الثلاثة معاً!
```

**السيناريوهات الممكنة**:
```
سيناريو 1: العميل فعّل البريد و SMS فقط
    ⬦ ○ ⬦
    ↙   ↘
  [بريد] [SMS]
  (التطبيق لم يُفعّل)

سيناريو 2: العميل فعّل الثلاثة
    ⬦ ○ ⬦
    ↙ ↓ ↘
  [بريد] [SMS] [تطبيق]
  (جميعها تُفعّل)

سيناريو 3: العميل فعّل SMS فقط
    ⬦ ○ ⬦
       ↓
     [SMS]
  (الباقي لم يُفعّل)
```

**مثال متوسط: فحوصات الجودة**
```
[المنتج جاهز للفحص]
      ↓
    ⬦ ○ ⬦  ما هي الفحوصات المطلوبة؟
    ↙ ↓ ↓ ↘
   /  | |  \
[فحص] [فحص] [فحص] [فحص]
وظيفي جمالي  متانة  أمان

الشروط:
- productType = "electronics" → وظيفي + أمان
- productType = "furniture" → جمالي + متانة
- productType = "toys" → الأربعة معاً
- isExport = true → أضف فحص أمان دائماً

مثال:
productType = "electronics" AND isExport = true
→ يُفعّل: وظيفي + أمان
```

**مثال معقد: معالجة مطالبة تأمين**
```
[استلام مطالبة تأمين]
      ↓
[تقييم المطالبة]
      ↓
    ⬦ ○ ⬦  ما هي التحقيقات المطلوبة؟
    ↙ ↓ ↓ ↓ ↘
   /  | | |  \
[تحقق] [تحقق] [تحقق] [تحقق] [تحقق]
طبي   فني   قانوني شرطة  خبير
                          تقييم

الشروط المعقدة:
- claimAmount > 10000 → تحقق فني + تحقق قانوني
- claimType = "injury" → تحقق طبي
- hasPoliceReport = true → تحقق شرطة
- propertyDamage = true → خبير تقييم
- isSuspicious = true → جميع التحقيقات

أمثلة:
1. مطالبة بسيطة (5000، سرقة، لا شكوك)
   → تحقق شرطة فقط

2. مطالبة متوسطة (15000، حادث سيارة)
   → فني + قانوني + شرطة + خبير

3. مطالبة مشكوك فيها
   → الخمسة معاً
```

---

### 2. Converging Inclusive Gateway (الدمج)

**الوظيفة**: انتظار المسارات المُفعّلة فقط ثم المتابعة

**الذكاء الخاص**:
البوابة "تتذكر" أي المسارات تم تفعيلها في Diverging، وتنتظر تلك المسارات فقط!

**مثال كامل: إشعارات العميل**
```
[تأكيد الطلب]
      ↓
    ⬦ ○ ⬦  Diverging
    ↙ ↓ ↘
   /  |  \
[بريد] [SMS] [Push]
  |     |      |
  ↓     ↓      ↓
[إرسال] [إرسال] [إرسال]
  |     |      |
   ↘    |     ↙
      ⬦ ○ ⬦  Converging
         ↓
    [تسجيل الإشعار]

السيناريو:
- إذا فُعّل بريد + SMS فقط
  → Converging ينتظر بريد + SMS فقط
  → لا ينتظر Push (لأنه لم يُفعّل)
```

**مثال: طرق الدفع المتعددة**
```
[العميل يريد الدفع]
      ↓
    ⬦ ○ ⬦  كيف سيدفع؟
    ↙ ↓ ↘
   /  |  \
[بطاقة] [نقدي] [نقاط]
ائتمان  عند    ولاء
        الاستلام
  |      |       |
  ↓      ↓       ↓
[معالجة] [تأكيد] [خصم]
الدفع   الطلب   النقاط
  |      |       |
   ↘     |      ↙
       ⬦ ○ ⬦  انتظار ما تم تفعيله
          ↓
     [إصدار فاتورة]

أمثلة:
1. بطاقة فقط → ينتظر معالجة الدفع
2. نقدي + نقاط → ينتظر الاثنين
3. الثلاثة معاً (دفع جزئي) → ينتظر الثلاثة
```

---

### 3. أمثلة واقعية متقدمة

**مثال A: نظام تنبيهات الطوارئ**
```
[اكتشاف حريق]
      ↓
[تحديد مستوى الخطر]
      ↓
    ⬦ ○ ⬦  ما هي الإجراءات؟
    ↙ ↓ ↓ ↓ ↘
   /  | | |  \
[إنذار] [رش] [قطع] [إخلاء] [اتصال]
محلي   ماء  كهرباء المبنى  الإطفاء

الشروط:
- fireLevel >= 1 → إنذار محلي
- fireLevel >= 2 → إنذار + رش ماء
- fireLevel >= 3 → إنذار + رش + قطع كهرباء
- fireLevel >= 4 → الأربعة + إخلاء
- fireLevel = 5 → جميعها + اتصال الإطفاء
- electricalFire = true → قطع كهرباء (بدون رش ماء!)

السيناريو 1: حريق صغير (المستوى 2)
    ⬦ ○ ⬦
    ↙   ↘
  [إنذار] [رش ماء]
    |       |
     ↘     ↙
       ⬦ ○ ⬦
          ↓
    [تقييم الوضع]

السيناريو 2: حريق كبير (المستوى 5)
    ⬦ ○ ⬦
    ↙ ↓ ↓ ↓ ↘
  الخمسة معاً
    |  | | |  |
     ↘ | | | ↙
       ⬦ ○ ⬦
          ↓
    [تقييم الوضع]
```

**مثال B: نشر محتوى على منصات التواصل**
```
[إنشاء منشور]
      ↓
[مراجعة المحتوى]
      ↓
    ⬦ ○ ⬦  أين سينشر؟
    ↙ ↓ ↓ ↓ ↓ ↘
   /  | | | |  \
[Facebook] [Twitter] [Instagram] [LinkedIn] [TikTok] [YouTube]
    |        |          |           |         |        |
    ↓        ↓          ↓           ↓         ↓        ↓
[نشر FB] [نشر TW] [نشر IG] [نشر LI] [نشر TT] [نشر YT]
و تكييف  و تكييف  و تكييف   و تكييف  و تكييف و تكييف
المحتوى  المحتوى  المحتوى   المحتوى  المحتوى المحتوى
    |        |          |           |         |        |
    ↓        ↓          ↓           ↓         ↓        ↓
[جدولة] [جدولة] [جدولة] [جدولة] [جدولة] [جدولة]
    |        |          |           |         |        |
     ↘       |          |           |         |       ↙
        ↘    |          |           |         |     ↙
           ↘ |          |           |         |   ↙
              ⬦ ○ ⬦  انتظار المنصات المُختارة
                 ↓
            [تجميع النتائج]
                 ↓
            [تقرير الأداء]

الشروط (بناءً على نوع المحتوى):
- contentType = "professional" → LinkedIn
- contentType = "visual" → Instagram + TikTok
- contentType = "news" → Facebook + Twitter
- contentType = "video" → YouTube + TikTok + Instagram
- targetAudience = "all" → جميع المنصات

مثال: محتوى مرئي احترافي
→ Instagram + LinkedIn + TikTok
```

**مثال C: فحوصات صحية شاملة**
```
[حجز فحص طبي شامل]
      ↓
[استشارة طبيب عام]
      ↓
    ⬦ ○ ⬦  الفحوصات المطلوبة؟
    ↙ ↓ ↓ ↓ ↓ ↓ ↘
   /  | | | | |  \
[دم] [بول] [قلب] [رئة] [نظر] [سمع] [أسنان]
  |    |     |     |     |     |      |
  ↓    ↓     ↓     ↓     ↓     ↓      ↓
[تحليل] [تحليل] [ECG] [أشعة] [فحص] [فحص] [فحص]
شامل   كامل   رسم   صدرية النظر السمع الأسنان
        قلب
  |    |     |     |     |     |      |
   ↘   |     |     |     |     |     ↙
      ↘|     |     |     |     |   ↙
        ⬦ ○ ⬦  انتظار الفحوصات المطلوبة
           ↓
      [تجميع النتائج]
           ↓
      [تقرير طبي شامل]
           ↓
      [استشارة متخصصة] ⬦ ○ ⬦  حسب النتائج
                        ↙ ↓ ↓ ↘
                       /  | |  \
                   [قلبية] [صدرية] [عيون] [أسنان]

الشروط المعقدة:
- age > 40 → دم + بول + قلب
- gender = "male" AND age > 50 → + رئة
- hasDiabetes = true → دم (شامل جداً)
- hasHeartDisease = true → قلب + رئة
- wearGlasses = true → نظر
- smoker = true → رئة (إجباري)
- package = "complete" → جميع الفحوصات
```

---

### متى تستخدم Inclusive Gateway؟

✅ **استخدم عندما**:
- يمكن تفعيل أكثر من مسار في نفس الوقت
- الشروط ليست متنافية
- عدد المسارات المُفعّلة يتغير حسب الحالة
- تريد مرونة في اختيار المسارات

❌ **لا تستخدم عندما**:
- تريد مسار واحد فقط → Exclusive Gateway
- تريد جميع المسارات دائماً → Parallel Gateway
- الاختيار بسيط (نعم/لا) → Exclusive Gateway

**تحذير مهم**:
```
⚠️ Inclusive Gateway أكثر تعقيداً من Exclusive و Parallel

مشكلة محتملة:
    ⬦ ○ ⬦  Diverging
    ↙     ↘
  مسار1   مسار2
    ↓       ↓
    |       |
    ↓       ↓
     ↘     ↙
       ⬦ X ⬦  ← ✗ خطأ! استخدام Exclusive للدمج

المشكلة: Exclusive ينتظر أول مسار يصل فقط
الحل: استخدم Inclusive للدمج أيضاً

✅ الصحيح:
    ⬦ ○ ⬦  Diverging
    ↙     ↘
  مسار1   مسار2
    ↓       ↓
     ↘     ↙
       ⬦ ○ ⬦  ← Converging Inclusive
```

---

## Event-Based Gateway

### الوصف
**بوابة مبنية على الأحداث** - الانتظار لحدوث أحد الأحداث، والمسار الذي يحدث حدثه أولاً يُفعّل.

### الرمز
- **معين مع دائرة ونجمة/خماسي** داخله
- أو **معين مع أيقونة مظروف**

### الشكل
```
        ↓
      ⬦ ◈ ⬦
    ↙   ↓   ↘
  (⭘)  (⭘)  (⭘)
حدث1  حدث2  حدث3
(أول حدث يحدث يُفعّل مساره)
```

### الخصائص الأساسية
- ✅ بعد البوابة يجب أن تكون أحداث فقط (Events)
- ✅ أول حدث يحدث، مساره يُفعّل
- ✅ باقي الأحداث يتم إلغاؤها
- ✅ مثالية للانتظار التنافسي

---

### أنواع Event-Based Gateway

### 1. Exclusive Event-Based Gateway (الافتراضي)

**الوظيفة**: انتظار حدوث أول حدث، وإلغاء الباقي

**مثال بسيط: انتظار رد العميل أو انتهاء المهلة**
```
[إرسال عرض للعميل]
      ↓
    ⬦ ◈ ⬦  انتظار
    ↙     ↘
  (✉️)    (⏰)
 استلام  مضى
  رد     48 ساعة
 العميل
   ↓       ↓
[معالجة] [إلغاء]
 الرد    العرض
   ↓       ↓
[متابعة] [إشعار]
         العميل
```

**السيناريو 1**: العميل رد خلال 24 ساعة
```
✅ حدث "استلام رد" وقع أولاً
   → مسار معالجة الرد يُفعّل
❌ حدث "مهلة 48 ساعة" يُلغى
```

**السيناريو 2**: العميل لم يرد
```
❌ لم يأتِ رد
✅ حدث "مهلة 48 ساعة" وقع
   → مسار إلغاء العرض يُفعّل
```

**مثال متوسط: خيارات الدفع**
```
[طلب الدفع من العميل]
      ↓
    ⬦ ◈ ⬦
    ↙ ↓ ↘
  (✉️) (✉️) (⏰)
  دفع  دفع  انتهت
  ببطاقة نقداً المهلة
    ↓    ↓     ↓
  [معالجة] [تأكيد] [إلغاء]
  الدفع   النقدي  الطلب
```

**مثال معقد: عملية مزاد**
```
[فتح المزاد على العنصر]
      ↓
[إشعار المزايدين]
      ↓
    ⬦ ◈ ⬦  انتظار
    ↙ ↓ ↓ ↘
  (✉️)(✉️)(✉️)(⏰)
 عرض عرض عرض انتهى
مزايد مزايد مزايد وقت
  A    B    C  المزاد
  ↓    ↓    ↓    ↓
[تسجيل العرض الجديد]  [إغلاق]
  ↓    ↓    ↓          المزاد
   ↘   |   ↙            ↓
      ⬦ X ⬦         [تحديد]
         ↓            الفائز
   [إعادة المزاد]      ↓
         ↓          [النهاية]
    ⬦ ◈ ⬦
    (العودة للانتظار)

كل عرض جديد:
1. يُسجّل العرض
2. يُمدّد وقت المزاد (مثلاً +5 دقائق)
3. يعود لانتظار عروض جديدة
```

---

### 2. Parallel Event-Based Gateway

**الوصف**: انتظار حدوث جميع الأحداث (نادر الاستخدام)

**الرمز**: معين مع دائرة ونجمة و**+**

**مثال: تجميع تأكيدات متعددة**
```
[طلب موافقات من 3 أطراف]
      ↓
    ⬦ ◈+ ⬦  انتظار الجميع
    ↙ ↓ ↘
  (✉️)(✉️)(✉️)
 موافقة موافقة موافقة
  طرف1  طرف2  طرف3
    ↓    ↓    ↓
     ↘   |   ↙
       ⬦ + ⬦
          ↓
     [المتابعة]
```

---

### أمثلة واقعية متقدمة

**مثال A: نظام حجز تذاكر**
```
[حجز مؤقت للتذكرة]
      ↓
[إرسال رابط الدفع]
      ↓
    ⬦ ◈ ⬦  انتظار
    ↙ ↓ ↓ ↘
  (✉️)(✉️)(✉️)(⏰)
 دفع إلغاء تعديل انتهت
 مكتمل من  الحجز المهلة
      العميل      (15 دقيقة)
   ↓    ↓    ↓      ↓
[تأكيد] [إلغاء] [تحديث] [إلغاء]
الحجز  الحجز  البيانات  الحجز
   ↓    ↓       ↓       ↓
[إصدار] [إعادة] [حفظ]  [إعادة]
التذكرة للمخزون التعديل للمخزون
   ↓    ↓       ↓       ↓
[إرسال] [End]   ⬦ ◈ ⬦ [End]
التذكرة      (العودة
   ↓         للانتظار)
[End]

ملاحظة: إذا اختار "تعديل الحجز"
→ يحدّث البيانات
→ يعود لانتظار الدفع أو الإلغاء
```

**مثال B: خدمة عملاء متعددة القنوات**
```
[طلب دعم من العميل]
      ↓
[عرض خيارات التواصل]
      ↓
    ⬦ ◈ ⬦  كيف سيتواصل؟
    ↙ ↓ ↓ ↓ ↘
  (✉️)(✉️)(✉️)(✉️)(⏰)
 رسالة اتصال محادثة زيارة مضت
 واتساب هاتفي مباشرة فرع  ساعة
        (Chat)     (بدون
                    تواصل)
   ↓    ↓    ↓    ↓     ↓
[فتح] [توجيه] [توصيل] [تحديد] [إرسال]
محادثة لممثل بممثل موعد  استبيان
واتساب       متاح         رضا
   |    |     |     |      |
   ↓    ↓     ↓     ↓      ↓
      [معالجة الطلب]    [إغلاق]
            ↓             تلقائي
       [حل المشكلة]         ↓
            ↓            [End]
       [تقييم الخدمة]
            ↓
         [End]
```

**مثال C: سباق خوارزميات ML**
```
[بدء تدريب 3 نماذج ML بالتوازي]
      ↓
    ⬦ + ⬦
    ↙ ↓ ↘
   /  |  \
[تدريب] [تدريب] [تدريب]
Model A Model B Model C
Neural  Random  Gradient
Network Forest  Boosting
   |      |       |
   ↓      ↓       ↓
    ⬦ ◈ ⬦  أي نموذج ينتهي أولاً؟
    ↙ ↓ ↘
  (⭘) (⭘) (⭘)
 اكتمال اكتمال اكتمال
   A     B     C
   ↓     ↓     ↓
[اختبار النموذج]
   ↓     ↓     ↓
    ↘    |    ↙
      ⬦ X ⬦
         ↓
   [⬦ X ⬦] الدقة مقبولة؟
    ↙        ↘
  نعم         لا
   ↓          ↓
[استخدام]  [انتظار النموذج التالي]
النموذج         ↓
   ↓         ⬦ ◈ ⬦
[إيقاف]     ↙     ↘
النماذج   (⭘)    (⭘)
الأخرى   النموذج النموذج
   ↓     التالي  التالي
[End]      ↓       ↓
       [نفس الاختبار]

الفكرة:
- تدريب 3 نماذج بالتوازي
- أول نموذج ينتهي، نختبره
- إذا دقته جيدة → نستخدمه ونوقف الباقي
- إذا لا → ننتظر النموذج التالي
```

---

### متى تستخدم Event-Based Gateway؟

✅ **استخدم عندما**:
- الانتظار لأحد الأحداث الخارجية
- سباق بين أحداث متعددة
- المهلات الزمنية (Timeouts)
- اختيار العميل بين قنوات تواصل

❌ **لا تستخدم عندما**:
- القرار يعتمد على بيانات/شروط → Exclusive Gateway
- تريد تنفيذ جميع المسارات → Parallel Gateway

**قاعدة مهمة**:
```
⚠️ بعد Event-Based Gateway يجب أن تكون:
✅ Events (Intermediate Catch Events)
✅ Receive Tasks
❌ ليس Activities عادية
❌ ليس Gateways أخرى

✅ صحيح:
    ⬦ ◈ ⬦
    ↙     ↘
  (⭘)    (⏰)
  رسالة  مهلة

❌ خطأ:
    ⬦ ◈ ⬦
    ↙     ↘
[نشاط] [نشاط]  ← خطأ!
```

---

## Complex Gateway

### الوصف
**بوابة معقدة** - للحالات التي لا تناسبها البوابات الأخرى، بقواعد معقدة مخصصة.

### الرمز
- **✱** (نجمة) أو **#** داخل المعين

### الشكل
```
        ↓
      ⬦ ✱ ⬦
    ↙   ↓   ↘
  مسار1 مسار2 مسار3
  (قواعد معقدة مخصصة)
```

### متى تُستخدم؟

Complex Gateway نادر الاستخدام، ويُستخدم فقط عندما:
- ❌ Exclusive لا يكفي
- ❌ Parallel لا يناسب
- ❌ Inclusive معقد جداً
- ✅ تحتاج قواعد مخصصة جداً

**مثال: موافقات معقدة**
```
[طلب موافقة على ميزانية مشروع]
      ↓
    ⬦ ✱ ⬦
    ↙ ↓ ↓ ↘
   /  | |  \
[موافق] [موافق مشروط] [مرفوض] [تحويل للجنة]

القاعدة المعقدة:
IF (budget <= 10000 AND department_approved = true)
   → موافق

ELSE IF (budget > 10000 AND budget <= 50000
         AND (cfo_approved = true OR ceo_approved = true))
   → موافق مشروط

ELSE IF (budget > 100000
         OR risk_level = "high"
         OR (department_approved = false AND budget > 5000))
   → تحويل للجنة

ELSE
   → مرفوض
```

**نصيحة مهمة**:
```
⚠️ حاول تجنب Complex Gateway قدر الإمكان!

بدلاً من:
    ⬦ ✱ ⬦  (قواعد معقدة)

حاول استخدام:
    ⬦ X ⬦
       ↓
    ⬦ X ⬦
       ↓
    ⬦ O ⬦
(تسلسل بوابات أبسط)

Complex Gateway يجعل المخطط صعب الفهم والصيانة
```

**مثال: تحويل Complex إلى بوابات أبسط**
```
❌ معقد (Complex):
    ⬦ ✱ ⬦  قواعد معقدة جداً
    ↙ ↓ ↓ ↘

✅ أبسط (تسلسل Exclusive):
    ⬦ X ⬦  المبلغ؟
    ↙     ↘
 <10K    >=10K
   ↓       ↓
[موافق]  ⬦ X ⬦  موافقة المدير؟
           ↙     ↘
         نعم      لا
          ↓       ↓
       [موافق] [مرفوض]
         مشروط
```

---

## المقارنة بين البوابات

### جدول مقارنة شامل

| الميزة | Exclusive (XOR) | Parallel (AND) | Inclusive (OR) | Event-Based | Complex |
|--------|-----------------|----------------|----------------|-------------|---------|
| **الرمز** | X أو فارغ | + | ○ | ◈ | ✱ |
| **عدد المسارات المُفعّلة** | 1 فقط | الجميع | 1 أو أكثر | 1 (أول حدث) | حسب القواعد |
| **نوع التقييم** | شروط | بدون شروط | شروط | أحداث | قواعد معقدة |
| **الدمج** | أول مسار | جميع المسارات | المُفعّلة فقط | - | حسب القواعد |
| **الاستخدام الشائع** | قرارات ثنائية | مهام متوازية | خيارات متعددة | سباق أحداث | نادر |
| **سهولة الفهم** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐ |

### متى تستخدم أي بوابة؟

#### مخطط قرار سريع:

```
                    [أحتاج بوابة]
                          ↓
                   ⬦ هل يعتمد على حدث خارجي؟
                    ↙              ↘
                  نعم              لا
                   ↓                ↓
            [Event-Based]    ⬦ كم مسار تريد تفعيله؟
                                ↙    ↓    ↘
                              1    الجميع  1+
                              ↓      ↓      ↓
                          [Exclusive] [Parallel] [Inclusive]
```

#### أمثلة عملية للاختيار:

**سيناريو 1: "العميل إما يوافق أو يرفض"**
```
→ Exclusive Gateway (XOR)
لأن: خيار واحد فقط
```

**سيناريو 2: "إرسال الطلب لـ 3 أقسام بالتوازي"**
```
→ Parallel Gateway (AND)
لأن: جميع الأقسام يجب أن تعالج
```

**سيناريو 3: "العميل يختار طرق الإشعار: بريد أو SMS أو كليهما"**
```
→ Inclusive Gateway (OR)
لأن: يمكن اختيار أكثر من واحد
```

**سيناريو 4: "انتظار رد العميل أو انتهاء المهلة"**
```
→ Event-Based Gateway
لأن: سباق بين حدثين
```

**سيناريو 5: "قواعد موافقة معقدة جداً مع استثناءات كثيرة"**
```
→ Complex Gateway (أو الأفضل: تقسيم لبوابات أبسط)
```

---

## أمثلة عملية متقدمة

### مثال شامل 1: نظام معالجة الطلبات الإلكترونية

```
[استلام طلب جديد]
      ↓
    ⬦ + ⬦  ← Parallel: فحوصات متوازية
    ↙ ↓ ↘
   /  |  \
[تحقق] [تحقق] [تحقق]
من     من     من
العميل المخزون السعر
  |      |       |
  ↓      ↓       ↓
 ✓/✗    ✓/✗     ✓/✗
  |      |       |
   ↘     |      ↙
      ⬦ + ⬦  ← Parallel Converging
         ↓
      ⬦ X ⬦  ← Exclusive: كل شيء صحيح؟
      ↙     ↘
    نعم      لا
     ↓        ↓
[حجز المنتج] [إشعار بالمشكلة]
     ↓        ↓
   ⬦ O ⬦    [End]
   ↙ ↓ ↘    ← Inclusive: طرق الدفع
  /  |  \
[بطاقة] [نقدي] [نقاط]
  |      |       |
  ↓      ↓       ↓
[معالجة الدفع]
  |      |       |
   ↘     |      ↙
      ⬦ O ⬦  ← Inclusive Converging
         ↓
      ⬦ X ⬦  ← Exclusive: الدفع نجح؟
      ↙     ↘
    نعم      لا
     ↓        ↓
[تأكيد الطلب] [إلغاء الحجز]
     ↓        ↓
[إرسال للشحن] [End]
     ↓
   ⬦ ◈ ⬦  ← Event-Based: تتبع الشحن
   ↙ ↓ ↘
 (⭘) (⭘) (⏰)
تم  إلغاء مضى
التسليم العميل 7 أيام
  ↓    ↓     ↓
[تأكيد] [رد المبلغ] [اتصال]
الاستلام  ↓      بالعميل
  ↓    [End]     ↓
[End]        ⬦ X ⬦
              ↙   ↘
           استلم  لم يستلم
             ↓      ↓
          [End] [فتح بلاغ]
                   ↓
                [End]
```

---

### مثال شامل 2: نظام الموارد البشرية - طلب إجازة

```
[تقديم طلب إجازة]
      ↓
    ⬦ X ⬦  ← Exclusive: نوع الإجازة؟
    ↙ ↓ ↓ ↘
   /  | |  \
[عادية] [مرضية] [طارئة] [سنوية]
  |      |        |        |
  ↓      ↓        ↓        ↓
   ↘     |        |       ↙
      ⬦ X ⬦  ← Converging
         ↓
      ⬦ X ⬦  ← Exclusive: المدة؟
      ↙ ↓ ↘
    1-3  4-7  >7
    يوم  أيام أيام
     |    |     |
     ↓    ↓     ↓
  [موافقة] [موافقة] ⬦ + ⬦  ← Parallel
  مباشرة  مدير     ↙     ↘
     |      |    [موافقة] [موافقة]
     ↓      ↓     مدير    HR
      ↘     |      |       |
         ⬦ X ⬦      ↘     ↙
            ↓         ⬦ + ⬦
         ⬦ X ⬦          ↓
         ↙   ↘      ⬦ X ⬦
      موافق  مرفوض   ↙   ↘
        ↓      ↓   موافق مرفوض
        |      |     |     |
        ↓      |      ↘   ↙
      ⬦ O ⬦    |        ⬦ X ⬦
      ↙ ↓ ↘   |           ↓
     /  |  \  |           ↓
  [بريد] [SMS] [نظام]    ↓
  إشعار إشعار تحديث  [إشعار بالرفض]
    |     |     |         ↓
     ↘    |    ↙       [End]
       ⬦ O ⬦
          ↓
    [تحديث رصيد الإجازات]
          ↓
       ⬦ ◈ ⬦  ← Event-Based
       ↙     ↘
     (⭘)    (⏰)
   الموظف  بداية
   يلغي   الإجازة
     ↓        ↓
  [إلغاء]  [End]
  الإجازة
     ↓
  [إرجاع الرصيد]
     ↓
  [End]
```

---

### مثال شامل 3: عملية إنتاج في مصنع

```
[استلام طلب إنتاج]
      ↓
    ⬦ + ⬦  ← Parallel: تحضير متوازي
    ↙ ↓ ↓ ↘
   /  | |  \
[حجز] [حجز] [حجز] [جدولة]
مواد  آلات  عمال  الإنتاج
 خام
  |    |     |      |
  ↓    ↓     ↓      ↓
   ↘   |     |     ↙
      ⬦ + ⬦  ← Converging
         ↓
    [بدء الإنتاج]
         ↓
      ⬦ X ⬦  ← Exclusive: نوع المنتج؟
      ↙ ↓ ↘
    بسيط متوسط معقد
      |   |    |
      ↓   ↓    ↓
    [خط] [خط] [خط]
    إنتاج 1  2    3
    سريع
      |   |    |
       ↘  |   ↙
         ⬦ X ⬦
            ↓
         ⬦ + ⬦  ← Parallel: فحص الجودة
         ↙     ↘
    [فحص بصري] [فحص وظيفي]
         |          |
         ↓          ↓
       ✓/✗        ✓/✗
         |          |
          ↘        ↙
            ⬦ + ⬦
               ↓
            ⬦ X ⬦  ← Exclusive: اجتاز الفحص؟
            ↙     ↘
          نعم      لا
           ↓        ↓
        [تعبئة]  ⬦ X ⬦  ← نوع العيب؟
           ↓      ↙ ↓ ↘
        [تخزين] /  |  \
           ↓   [إعادة] [إصلاح] [رفض]
        ⬦ O ⬦  تصنيع
        ↙ ↓ ↘    |      |      |
       /  |  \   |      |      |
    [شحن] [بيع] [حجز]   ↓      ↓      ↓
    مباشر محلي لطلب    |      |   [إعادة]
                 آخر    ↓      |    تدوير
      |    |     |      |      |      |
       ↘   |     |   [العودة   ↓   [End]
          ⬦ O ⬦      للفحص] [العودة
             ↓               للفحص]
          [End]
```

---

## الأخطاء الشائعة

### 1. عدم إغلاق Parallel/Inclusive Gateway

❌ **خطأ شائع جداً**:
```
    ⬦ + ⬦  فتح
    ↙     ↘
  مسار1   مسار2
    ↓       ↓
  [End]   [End]  ← خطأ! لم يتم الإغلاق
```

✅ **الصحيح**:
```
    ⬦ + ⬦  فتح
    ↙     ↘
  مسار1   مسار2
    ↓       ↓
     ↘     ↙
       ⬦ + ⬦  إغلاق
          ↓
       [End]
```

---

### 2. استخدام بوابة خاطئة للدمج

❌ **خطأ**:
```
    ⬦ O ⬦  Inclusive Diverging
    ↙     ↘
  مسار1   مسار2
    ↓       ↓
     ↘     ↙
       ⬦ X ⬦  ← خطأ! Exclusive للدمج
```

✅ **الصحيح**:
```
    ⬦ O ⬦  Inclusive Diverging
    ↙     ↘
  مسار1   مسار2
    ↓       ↓
     ↘     ↙
       ⬦ O ⬦  ← صحيح! نفس النوع
```

**القاعدة الذهبية**:
```
الدمج يجب أن يكون من نفس نوع التفرّع!

Exclusive ⬦ X ⬦ → ⬦ X ⬦
Parallel  ⬦ + ⬦ → ⬦ + ⬦
Inclusive ⬦ O ⬦ → ⬦ O ⬦
```

---

### 3. شروط Exclusive متداخلة (غير متنافية)

❌ **خطأ**:
```
    ⬦ X ⬦
    ↙     ↘
  age > 18  age > 25

  مشكلة: إذا age = 30
  → كلا الشرطين صحيح! أيهما يُفعّل؟
```

✅ **الصحيح**:
```
    ⬦ X ⬦
    ↙ ↓ ↘
age<18 18-25 >25

أو:
    ⬦ X ⬦
    ↙     ↘
age<=25  age>25
```

---

### 4. عدم وجود مسار افتراضي (Default Flow)

❌ **خطأ**:
```
    ⬦ X ⬦
    ↙     ↘
status="A" status="B"

مشكلة: ماذا لو status = "C"؟
```

✅ **الصحيح**:
```
    ⬦ X ⬦
    ↙ ↓ ↘
  A   B  [افتراضي]
           (باقي الحالات)
```

---

### 5. استخدام Activities بعد Event-Based Gateway

❌ **خطأ**:
```
    ⬦ ◈ ⬦
    ↙     ↘
[نشاط1] [نشاط2]  ← خطأ!
```

✅ **الصحيح**:
```
    ⬦ ◈ ⬦
    ↙     ↘
  (⭘)    (⏰)  ← Events فقط!
  حدث1   حدث2
```

---

### 6. Parallel Gateway بدون حاجة

❌ **غير ضروري**:
```
    ⬦ + ⬦
       ↓  (مسار واحد فقط!)
    [نشاط]
       ↓
    ⬦ + ⬦
```

✅ **الصحيح**:
```
    [نشاط]  ← لا حاجة للبوابة
```

---

## أفضل الممارسات

### 1. الوضوح أولاً

✅ **استخدم أسماء واضحة للشروط**:
```
❌ سيء:
    ⬦ X ⬦
    ↙     ↘
  نعم     لا

✅ جيد:
    ⬦ X ⬦  المبلغ > 1000؟
    ↙           ↘
  نعم (>1000)  لا (<=1000)
```

---

### 2. التوازن بين البساطة والدقة

```
✅ بسيط ومفهوم:
    ⬦ X ⬦
    ↙     ↘
  خيار1  خيار2

❌ معقد بدون داع:
    ⬦ X ⬦
       ↓
    ⬦ X ⬦
       ↓
    ⬦ X ⬦
       ↓
    ⬦ X ⬦
(يمكن دمجها في بوابة واحدة)
```

---

### 3. توثيق القرارات المعقدة

```
[حساب الأهلية]
      ↓
    ⬦ X ⬦

توثيق:
━━━━━━━━━━━━━━━━━━━━━━━━━━
الشروط:
- المسار A: creditScore >= 700
- المسار B: creditScore >= 600 AND guarantor exists
- افتراضي: رفض
━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### 4. اختبار جميع المسارات

```
لكل بوابة، تأكد من:
✅ جميع المسارات لها نهاية
✅ لا يوجد مسارات معلقة (Dead-end)
✅ الشروط واضحة ومتنافية (في Exclusive)
✅ المسارات المتوازية تُدمج بشكل صحيح
```

---

### 5. تجنب التعقيد الزائد

```
❌ تجنب:
- أكثر من 5 مسارات من بوابة واحدة
- تداخل بوابات أكثر من 3 مستويات
- Complex Gateway إلا للضرورة القصوى

✅ بدلاً منها:
- قسّم إلى Sub-Processes
- استخدم Business Rule Task
- أعد هيكلة العملية
```

---

## الخلاصة

### ملخص سريع

| البوابة | متى تستخدمها | مثال |
|---------|---------------|------|
| **Exclusive (XOR)** | قرار واحد من عدة خيارات | موافق/مرفوض |
| **Parallel (AND)** | تنفيذ مهام متوازية | إرسال لـ3 أقسام |
| **Inclusive (OR)** | خيارات متعددة ممكنة | بريد و/أو SMS |
| **Event-Based** | انتظار أحداث خارجية | رد العميل أو مهلة |
| **Complex** | قواعد معقدة جداً | (نادر - تجنبه) |

### القواعد الذهبية

1. **التفرّع والدمج من نفس النوع**
   ```
   ⬦ + ⬦ → ... → ⬦ + ⬦  ✅
   ⬦ + ⬦ → ... → ⬦ X ⬦  ❌
   ```

2. **Exclusive يجب أن يكون له Default Flow**
   ```
   ⬦ X ⬦  مع مسار افتراضي ✅
   ```

3. **Parallel دائماً يُغلق**
   ```
   ⬦ + ⬦ فتح ... ⬦ + ⬦ إغلاق ✅
   ```

4. **Event-Based بعده أحداث فقط**
   ```
   ⬦ ◈ ⬦ → (⭘) Events ✅
   ⬦ ◈ ⬦ → [نشاط] ❌
   ```

5. **الوضوح أهم من الاختصار**
   ```
   مخطط بسيط ومفهوم > مخطط مختصر ومعقد
   ```

---

**تم إنشاء هذا الدليل كمرجع شامل لـ BPMN Gateways**

البوابات هي نقاط التحكم في BPMN، وفهمها الصحيح ضروري لنمذجة العمليات بفعالية!
